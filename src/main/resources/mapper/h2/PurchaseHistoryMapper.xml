<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.PurchaseHistoryMapper">

	<resultMap id="goods" type="com.example.domain.goods.model.MGoods">
		<id column="goods_id" property="goodsId" />
		<result column="goods_name" property="goodsName" />
		<result column="goods_description" property="goodsDescription" />
		<result column="price" property="price" />
		<result column="goods_category_id" property="goodsCategoryId"/>
		<result column="service_url" property="serviceURL"/>
		<association property="goodsCategory" resultMap="goods_category"></association>
	</resultMap>
	
	<resultMap id="goods_category" type="com.example.domain.goods.model.MGoodsCategory">
		<id column="goods_category_id" property="goodsCategoryId" />
		<result column="goods_category_name" property="goodsCategoryName"/>
	</resultMap>

    <select id="findPurchasedGoodsListByUserId" resultMap="goods">
        select
            *
         from
            m_goods
            left join m_goods_category
            	on m_goods.goods_category_id = m_goods_category.goods_category_id
         where
            goods_id in (
                select
                    goods_id
                from
                    t_purchase_history
                where
                    user_id = #{userId}
            )
    </select>
    
</mapper>